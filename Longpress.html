<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Press Demo</title>
    <meta name="theme-color" content="#4a148c">
    <meta name="description" content="Demo of long press vs short press on links">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            padding: 16px;
            background-color: #f5f5f5;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 24px;
            color: #4a148c;
        }
        
        .items-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 16px;
        }
        
        .item {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .item:active {
            transform: scale(0.98);
        }
        
        .item-link {
            display: block;
            text-decoration: none;
            color: #333;
            -webkit-tap-highlight-color: transparent;
        }
        
        .item-image {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }
        
        .item-title {
            padding: 12px;
            font-size: 14px;
            text-align: center;
        }
        
        .context-menu {
            position: fixed;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 100;
            display: none;
            min-width: 160px;
            overflow: hidden;
        }
        
        .context-menu button {
            width: 100%;
            padding: 12px 16px;
            border: none;
            background: none;
            text-align: left;
            font-size: 14px;
            color: #333;
        }
        
        .context-menu button:hover {
            background: #f0f0f0;
        }
        
        .context-menu button.delete {
            color: #e53935;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.2);
            z-index: 99;
            display: none;
        }
        
        @media (max-width: 600px) {
            .items-container {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }
    </style>
</head>
<body>
    <h1>Press Demo</h1>
    <p style="text-align: center; margin-bottom: 20px;">Short press to open link, long press for menu</p>
    
    <div class="items-container" id="itemsContainer">
        <!-- Items will be generated by JavaScript -->
    </div>
    
    <div class="overlay" id="overlay"></div>
    
    <div class="context-menu" id="contextMenu">
        <button class="favorite">‚ù§Ô∏è Add to favorites</button>
        <button class="delete">üóëÔ∏è Delete this item</button>
        <button class="cancel">‚úï Cancel</button>
    </div>
    
    <script>
        // Generate sample items
        const itemsContainer = document.getElementById('itemsContainer');
        const contextMenu = document.getElementById('contextMenu');
        const overlay = document.getElementById('overlay');
        
        // Sample data for items
        const sampleItems = [];
        for (let i = 1; i <= 200; i++) {
            sampleItems.push({
                id: i,
                title: `Item ${i}`,
                image: `https://picsum.photos/200/150?random=${i}`,
                url: `https://example.com/item${i}`
            });
        }
        
        // Create HTML for items
        function createItems() {
            itemsContainer.innerHTML = sampleItems.map(item => `
                <div class="item" data-id="${item.id}">
                    <a href="${item.url}" class="item-link" data-id="${item.id}">
                        <img src="${item.image}" alt="${item.title}" class="item-image">
                        <div class="item-title">${item.title}</div>
                    </a>
                </div>
            `).join('');
        }
        
        // Initialize the app
        function init() {
            createItems();
            setupEventListeners();
        }
        
        // Variables to track press state
        let pressTimer;
        let pressedItemId = null;
        const longPressDuration = 500; // milliseconds
        
        // Setup event listeners for all links
        function setupEventListeners() {
            const links = document.querySelectorAll('.item-link');
            
            links.forEach(link => {
                // Touch events for mobile
                link.addEventListener('touchstart', handlePressStart);
                link.addEventListener('touchend', handlePressEnd);
                link.addEventListener('touchmove', handlePressCancel);
                
                // Mouse events for desktop testing
                link.addEventListener('mousedown', handlePressStart);
                link.addEventListener('mouseup', handlePressEnd);
                link.addEventListener('mouseleave', handlePressCancel);
                
                // Prevent context menu on long press
                link.addEventListener('contextmenu', (e) => e.preventDefault());
            });
            
            // Context menu buttons
            document.querySelector('.context-menu .favorite').addEventListener('click', () => {
                alert(`Added item ${pressedItemId} to favorites`);
                hideContextMenu();
            });
            
            document.querySelector('.context-menu .delete').addEventListener('click', () => {
                alert(`Deleted item ${pressedItemId}`);
                hideContextMenu();
            });
            
            document.querySelector('.context-menu .cancel').addEventListener('click', hideContextMenu);
            
            // Close menu when clicking overlay
            overlay.addEventListener('click', hideContextMenu);
        }
        
        function handlePressStart(e) {
            // Get the item ID
            const itemId = e.currentTarget.getAttribute('data-id');
            pressedItemId = itemId;
            
            // Start timer for long press
            pressTimer = setTimeout(() => {
                showContextMenu(e, itemId);
            }, longPressDuration);
            
            // Prevent default to avoid triggering click immediately on touchend
            e.preventDefault();
        }
        
        function handlePressEnd(e) {
            // If the press ended before long press duration, it's a short press
            if (pressTimer) {
                clearTimeout(pressTimer);
                
                // Only proceed with short press if we didn't show the context menu
                if (pressedItemId) {
                    // For touch events, we need to simulate the click
                    if (e.type === 'touchend') {
                        const link = e.currentTarget;
                        window.location.href = link.href;
                    }
                    // For mouse events, the default click will handle it
                }
            }
            
            pressedItemId = null;
        }
        
        function handlePressCancel() {
            // If finger/mouse moves, cancel the press
            if (pressTimer) {
                clearTimeout(pressTimer);
                pressTimer = null;
            }
            pressedItemId = null;
        }
        
        function showContextMenu(e, itemId) {
            // Clear the timer
            if (pressTimer) {
                clearTimeout(pressTimer);
                pressTimer = null;
            }
            
            // Position the context menu near the pressed item
            let x, y;
            
            if (e.type.includes('touch')) {
                const touch = e.touches[0] || e.changedTouches[0];
                x = touch.clientX;
                y = touch.clientY;
            } else {
                x = e.clientX;
                y = e.clientY;
            }
            
            // Adjust position to ensure it stays on screen
            const menuWidth = contextMenu.offsetWidth;
            const menuHeight = contextMenu.offsetHeight;
            
            if (x + menuWidth > window.innerWidth) {
                x = window.innerWidth - menuWidth - 10;
            }
            
            if (y + menuHeight > window.innerHeight) {
                y = window.innerHeight - menuHeight - 10;
            }
            
            contextMenu.style.left = `${x}px`;
            contextMenu.style.top = `${y}px`;
            contextMenu.style.display = 'block';
            overlay.style.display = 'block';
        }
        
        function hideContextMenu() {
            contextMenu.style.display = 'none';
            overlay.style.display = 'none';
            pressedItemId = null;
        }
        
        // PWA setup
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').then(registration => {
                    console.log('ServiceWorker registration successful');
                }).catch(err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
        
        // Start the app
        init();
    </script>
</body>
</html>