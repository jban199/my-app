<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=overlays-content">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>TKA - Webrowser</title>

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="favicon.ico" sizes="any">
    <meta name="theme-color" content="#1A1A1A">

    <!-- Link to the stylesheet -->
    <link rel="stylesheet" href="styles.css">

</head>
<body>

<section class="ts-header">
	<h1 class="ts-pagename"> Webrowser </h1>

<div id="ts-search-container">
    <div id="ts-search-bar">
      <input type="text" id="ts-search-input" placeholder="Search...">
      <button id="ts-search-btn">
		<svg height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
			<path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/>
		</svg>
	  </button>
    
		<div id="ts-engine-select">
			<div id="ts-selected-engine" class="ts-search-engine-icon" onclick="toggleDropdown()">
				<img id="ts-selected-icon" src="images/icons/google.svg" alt="Google Icon">
				<div class="ts-selected-engine-helper">Tap here</div>
			</div>

			<div id="ts-search-engine-dropdown" class="ts-search-engine-dropdown">
				<div class="ts-search-engine-dropdown-item" onclick="selectEngine('google', 'images/icons/google.svg')">
					<img src="images/icons/google.svg" alt="Google Icon"> Google
				</div>
				<div class="ts-search-engine-dropdown-item" onclick="selectEngine('bing', 'images/icons/bing.svg')">
					<img src="images/icons/bing.svg" alt="Bing Icon"> Bing
				</div>
				<div class="ts-search-engine-dropdown-item" onclick="selectEngine('yahoo', 'images/icons/yahoo.svg')">
					<img src="images/icons/yahoo.svg" alt="Yahoo Icon"> Yahoo
				</div>
				<div class="ts-search-engine-dropdown-item" onclick="selectEngine('duckduckgo', 'images/icons/duckduckgo.svg')">
					<img src="images/icons/duckduckgo.svg" alt="DuckDuckGo Icon"> DuckDuckGo
				</div>
				<div class="ts-search-engine-dropdown-item" onclick="selectEngine('youtube', 'images/icons/youtube.svg')">
					<img src="images/icons/youtube.svg" alt="YouTube Icon"> YouTube
				</div>
				<div class="ts-search-engine-dropdown-item" onclick="selectEngine('wikipedia', 'images/icons/wikipedia.svg')">
					<img src="images/icons/wikipedia.svg" alt="Wikipedia Icon"> Wikipedia
				</div>
			</div>
		</div>
	</div>
</div>
  
<script>
// Function to toggle dropdown visibility
function toggleDropdown() {
  const searchEngineDropdown = document.getElementById('ts-search-engine-dropdown');
  searchEngineDropdown.classList.toggle('show');
}

// Function to select a search engine
function selectEngine(engine, icon) {
  // Update the selected icon
  document.getElementById('ts-selected-icon').src = icon;

  // Save the selected engine to localStorage
  localStorage.setItem('preferredEngine', engine);

  // Close the dropdown
  toggleDropdown();
}

// Initialize the search engine preference on page load
document.addEventListener('DOMContentLoaded', () => {
  // Get the saved preference from localStorage
  let preferredEngine = localStorage.getItem('preferredEngine') || 'google';
  const engineIconMap = {
    google: 'images/icons/google.svg',
    bing: 'images/icons/bing.svg',
    yahoo: 'images/icons/yahoo.svg',
    duckduckgo: 'images/icons/duckduckgo.svg',
    youtube: 'images/icons/youtube.svg',
    wikipedia: 'images/icons/wikipedia.svg'
  };

  // Set the default icon based on the stored preference
  const selectedIcon = engineIconMap[preferredEngine] || 'google-icon.png';
  document.getElementById('ts-selected-icon').src = selectedIcon;
});

// Function to handle search based on selected engine
document.getElementById('ts-search-btn').addEventListener('click', () => {
  const query = document.getElementById('ts-search-input').value.trim();
  let searchUrl = '';
  const selectedEngine = localStorage.getItem('preferredEngine') || 'google';

  if (query) {
    switch (selectedEngine) {
      case 'google':
        searchUrl = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
        break;
      case 'bing':
        searchUrl = `https://www.bing.com/search?q=${encodeURIComponent(query)}`;
        break;
      case 'yahoo':
        searchUrl = `https://search.yahoo.com/search?p=${encodeURIComponent(query)}`;
        break;
      case 'duckduckgo':
        searchUrl = `https://duckduckgo.com/?q=${encodeURIComponent(query)}`;
        break;
      case 'youtube':
        searchUrl = `https://www.youtube.com/results?search_query=${encodeURIComponent(query)}`;
        break;
      case 'wikipedia':
        searchUrl = `https://en.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(query)}`;
        break;
    }
    window.open(searchUrl, '_blank'); // Open search in a new tab
  }
});

</script>
</section>


<!-- ///////////////// -->
<!-- Websites -->
<!-- ///////////////// -->
<div class="ts-sectionname">
	My links
	<button class="ts-manage-btn" onclick="openManageLinkModal()">Manage</button>
</div>
<section class="ts-options-container" id="ts-links-container">
	<!-- Add button (always first) -->
	<div class="ts-option">
    <button class="ts-link-add-btn" onclick="openAddLinkModal()">+</button>
  </div>
	<!-- Links will be inserted here dynamically -->
	
	<script>
	// Function to load and display links from IndexedDB
function loadLinks() {
  const container = document.getElementById('ts-links-container');
  if (!container) return;

  // Clear existing links (except the first add button)
  while (container.children.length > 1) {
    container.removeChild(container.lastChild);
  }

  const transaction = webDb.transaction([webStoreName], "readonly");
  const store = transaction.objectStore(webStoreName);
  const request = store.getAll();

  request.onsuccess = (e) => {
    const links = e.target.result;
    
    // Sort links by position
    links.sort((a, b) => a.position - b.position);

    // Add each link to the container
    links.forEach(link => {
      const linkElement = createLinkElement(link);
      container.appendChild(linkElement);
    });
  };

  request.onerror = (e) => {
    console.error("Error loading links", e);
    showWebSnackbar("Error loading links");
  };
}

// Helper function to create a link element
function createLinkElement(linkData) {
  const optionDiv = document.createElement('div');
  optionDiv.className = 'ts-option';
  optionDiv.dataset.id = linkData.id;

  const link = document.createElement('a');
  link.href = linkData.url;
  link.target = '_blank';

  // Use provided image or fallback to favicon
  const imgSrc = linkData.img || `https://www.google.com/s2/favicons?domain=${new URL(linkData.url).hostname}`;
  const img = document.createElement('img');
  img.src = imgSrc;
  img.onerror = () => { img.src = 'images/icons/default-link.svg'; }; // Fallback if image fails to load

  const title = document.createElement('h3');
  title.textContent = linkData.name;

  link.appendChild(img);
  link.appendChild(title);
  optionDiv.appendChild(link);

  return optionDiv;
}

// Initialize the database and load links when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  // Initialize the save button
  const saveBtn = document.getElementById("ts-add-link-modal-save-btn");
  if (saveBtn) {
    saveBtn.addEventListener('click', saveLink);
  }

  // Load links when database is ready
  webOpenRequest.onsuccess = (e) => {
    webDb = e.target.result;
    loadLinks();
  };
});

// Modified saveLink function to refresh display after saving
function saveLink() {
  const name = document.getElementById("ts-add-link-name").value.trim();
  const url = document.getElementById("ts-add-link-url").value.trim();
  const img = document.getElementById("ts-add-link-img").value.trim();

  if (!name || !url) {
    showWebSnackbar("Name and URL are required");
    return;
  }

  if (!isValidUrl(url)) {
    showWebSnackbar("Please enter a valid URL (include http:// or https://)");
    return;
  }

  const transaction = webDb.transaction([webStoreName], "readwrite");
  const store = transaction.objectStore(webStoreName);
  const countRequest = store.count();
  
  countRequest.onsuccess = () => {
    const linkData = { 
      name, 
      url: formatUrl(url),
      img,
      position: currentEditingLinkId !== null ? 
                undefined : // Keep existing position when editing
                countRequest.result // New position for new items
    };

    if (currentEditingLinkId !== null) {
      linkData.id = currentEditingLinkId;
      store.put(linkData);
      showWebSnackbar("Link updated");
    } else {
      store.add(linkData);
      showWebSnackbar("Link saved");
    }

    transaction.oncomplete = () => {
      closeAddLinkModal();
      clearLinkForm();
      loadLinks(); // Refresh the display
    };
  };
}
	</script>
</section>


<div class="ts-sectionname">
	All Websites
	<button class="ts-filter-btn">
		<svg height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
			<path d="M440-160q-17 0-28.5-11.5T400-200v-240L168-736q-15-20-4.5-42t36.5-22h560q26 0 36.5 22t-4.5 42L560-440v240q0 17-11.5 28.5T520-160h-80Z"/>
		</svg>
		All
	</button>
</div>
<section class="ts-options-list">
	<div class="ts-option-wide">
		<a class="ts-option-details" href="https://www.google.com" target="_blank">
			<img class="ts-option-img" src="https://www.google.com/images/branding/googlelogo/1x/googlelogo_color_272x92dp.png">
			<div class="ts-option-link-info">
				<p class="ts-option-title">Google</p>
				<p class="ts-option-link">https://www.google.com</p>
				<p class="ts-option-tags">Browser, Search engines</p>
			</div>
		</a>
		<button class="ts-option-more-btn">
			<svg class="ts-allweb-option-list-btn-icon" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
				<path d="M480-160q-33 0-56.5-23.5T400-240q0-33 23.5-56.5T480-320q33 0 56.5 23.5T560-240q0 33-23.5 56.5T480-160Zm0-240q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm0-240q-33 0-56.5-23.5T400-720q0-33 23.5-56.5T480-800q33 0 56.5 23.5T560-720q0 33-23.5 56.5T480-640Z"></path>
			</svg>
		</button>
	</div>
	
	<div class="ts-option-wide">
		<a class="ts-option-details" href="https://stackoverflow.com" target="_blank">
			<img class="ts-option-img" src="https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png">
			<div class="ts-option-link-info">
				<p class="ts-option-title">Stack Overflow</p>
				<p class="ts-option-link">https://stackoverflow.com</p>
				<p class="ts-option-tags">Browser, Search engines</p>
			</div>
		</a>
		<button class="ts-option-more-btn">
			<svg class="ts-allweb-option-list-btn-icon" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
				<path d="M480-160q-33 0-56.5-23.5T400-240q0-33 23.5-56.5T480-320q33 0 56.5 23.5T560-240q0 33-23.5 56.5T480-160Zm0-240q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm0-240q-33 0-56.5-23.5T400-720q0-33 23.5-56.5T480-800q33 0 56.5 23.5T560-720q0 33-23.5 56.5T480-640Z"></path>
			</svg>
		</button>
	</div>
	
	<div class="ts-option-wide">
		<a class="ts-option-details" href="https://stackoverflow.com" target="_blank">
			<img class="ts-option-img" src="https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.pngs">
			<div class="ts-option-link-info">
				<p class="ts-option-title">Stack Overflow</p>
				<p class="ts-option-link">https://stackoverflow.com</p>
				<p class="ts-option-tags">Browser, Search engines</p>
			</div>
		</a>
		<button class="ts-option-more-btn">
			<svg class="ts-allweb-option-list-btn-icon" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
				<path d="M480-160q-33 0-56.5-23.5T400-240q0-33 23.5-56.5T480-320q33 0 56.5 23.5T560-240q0 33-23.5 56.5T480-160Zm0-240q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm0-240q-33 0-56.5-23.5T400-720q0-33 23.5-56.5T480-800q33 0 56.5 23.5T560-720q0 33-23.5 56.5T480-640Z"></path>
			</svg>
		</button>
	</div>
	
</section>


<!-- ///////////////// -->
<!-- Add Link Modal -->
<!-- ///////////////// -->
<section id="ts-add-link-modal" style="display:none;">
	<div class="ts-add-link-modal-header">
		<button id="ts-add-link-modal-back-btn" onclick="closeAddLinkModal()">
			<svg height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
				<path d="m313-440 196 196q12 12 11.5 28T508-188q-12 11-28 11.5T452-188L188-452q-6-6-8.5-13t-2.5-15q0-8 2.5-15t8.5-13l264-264q11-11 27.5-11t28.5 11q12 12 12 28.5T508-715L313-520h447q17 0 28.5 11.5T800-480q0 17-11.5 28.5T760-440H313Z"/>
			</svg>
		</button>
		Add Link
	</div>
	<div class="ts-add-link-modal-body">
		
		<label for="ts-add-link-name">Name</label>
		<input type="text" id="ts-add-link-name" placeholder="Example.com">
		
		<label for="ts-add-link-url">Address</label>
		<input type="text" id="ts-add-link-url" placeholder="https://www.example.com">
		
		<label for="ts-add-link-img">Image URL (optional)</label>
		<input type="text" id="ts-add-link-img" placeholder="Image link">
	</div>
	<div class="ts-add-link-modal-footer">
		<button id="ts-add-link-modal-cancel-btn" onclick="closeAddLinkModal()">Cancel</button>
		<button id="ts-add-link-modal-save-btn">Save</button>
	</div>
	
	<script>
	function closeAddLinkModal() {
		const modal = document.getElementById('ts-add-link-modal');
		if (modal) {
			modal.style.display = 'none';
		}
	}
	
	function openAddLinkModal() {
		const modal = document.getElementById('ts-add-link-modal');
		if (modal) {
			modal.style.display = 'block';
		}
	}
	
	
	// Link Management Module
let webDb;
const webDbName = "TAKAppDB";
const webStoreName = "CustomSites";
let currentEditingLinkId = null;

const webOpenRequest = indexedDB.open(webDbName);

webOpenRequest.onupgradeneeded = (e) => {
  webDb = e.target.result;
  const objectStore = webDb.createObjectStore(webStoreName, { 
    keyPath: "id", 
    autoIncrement: true 
  });
  
  objectStore.createIndex("name", "name", { unique: false });
  objectStore.createIndex("url", "url", { unique: false });
  objectStore.createIndex("img", "img", { unique: false });
  objectStore.createIndex("position", "position", { unique: false });
};

webOpenRequest.onsuccess = (e) => {
  webDb = e.target.result;
  loadLinks(); // Function to load existing links (to be implemented later)
};

webOpenRequest.onerror = (e) => {
  console.error("Error opening IndexedDB", e);
  showWebSnackbar("Error opening database");
};

// Save link function
function saveLink() {
  const name = document.getElementById("ts-add-link-name").value.trim();
  const url = document.getElementById("ts-add-link-url").value.trim();
  const img = document.getElementById("ts-add-link-img").value.trim();

  if (!name || !url) {
    showWebSnackbar("Name and Address are required");
    return;
  }

  // Basic URL validation
  if (!isValidUrl(url)) {
    showWebSnackbar("Please enter a valid URL (include http:// or https://)");
    return;
  }

  const transaction = webDb.transaction([webStoreName], "readwrite");
  const store = transaction.objectStore(webStoreName);

  // Get current count to set position (for future reordering)
  const countRequest = store.count();
  
  countRequest.onsuccess = () => {
    const linkData = { 
      name, 
      url: formatUrl(url),
      img,
      position: countRequest.result // This will be the next available position
    };

    if (currentEditingLinkId !== null) {
      // For editing, keep the same position
      linkData.id = currentEditingLinkId;
      store.put(linkData);
      currentEditingLinkId = null;
      showWebSnackbar("Link updated");
    } else {
      store.add(linkData);
      showWebSnackbar("Link saved");
    }

    transaction.oncomplete = () => {
      closeAddLinkModal();
      clearLinkForm();
      loadLinks(); // Function to refresh the links display
    };

    transaction.onerror = (e) => {
      console.error("Error saving link", e);
      showWebSnackbar("Error saving link");
    };
  };
}

// Helper function to validate URLs
function isValidUrl(string) {
  try {
    new URL(string);
    return true;
  } catch (_) {
    return false;
  }
}

// Helper function to format URLs (ensure they have http/https)
function formatUrl(url) {
  if (!url.startsWith('http://') && !url.startsWith('https://')) {
    return 'https://' + url;
  }
  return url;
}

// Clear the link form
function clearLinkForm() {
  document.getElementById("ts-add-link-name").value = "";
  document.getElementById("ts-add-link-url").value = "";
  document.getElementById("ts-add-link-img").value = "";
}

// Initialize the save button
document.addEventListener('DOMContentLoaded', () => {
  const saveBtn = document.getElementById("ts-add-link-modal-save-btn");
  if (saveBtn) {
    saveBtn.addEventListener('click', saveLink);
  }
});

// Modified openAddLinkModal function to handle editing
function openAddLinkModal(linkData = null) {
  const modal = document.getElementById('ts-add-link-modal');
  if (modal) {
    if (linkData) {
      // Editing existing link
      currentEditingLinkId = linkData.id;
      document.getElementById("ts-add-link-name").value = linkData.name;
      document.getElementById("ts-add-link-url").value = linkData.url;
      document.getElementById("ts-add-link-img").value = linkData.img || "";
    } else {
      // Adding new link
      currentEditingLinkId = null;
      clearLinkForm();
    }
    modal.style.display = 'block';
  }
}
	
	</script>
</section>




<!-- ///////////////// -->
<!-- Manage Links Modal -->
<!-- ///////////////// -->
<section id="ts-manage-link-modal" style="display: none;">
	<div class="ts-manage-link-modal-header">
		<button id="ts-manage-link-modal-back-btn" onclick="closeManageLinkModal()">
			<svg height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
				<path d="m313-440 196 196q12 12 11.5 28T508-188q-12 11-28 11.5T452-188L188-452q-6-6-8.5-13t-2.5-15q0-8 2.5-15t8.5-13l264-264q11-11 27.5-11t28.5 11q12 12 12 28.5T508-715L313-520h447q17 0 28.5 11.5T800-480q0 17-11.5 28.5T760-440H313Z"/>
			</svg>
		</button>
		Manage Links
	</div>
	<div class="ts-manage-link-modal-body">
	</div>
	<div class="ts-manage-link-modal-footer">
		<button id="ts-manage-link-modal-cancel-btn" onclick="closeManageLinkModal()">Cancel</button>
		<button id="ts-manage-link-modal-save-btn">Save</button>
	</div>
	
	<script>
	function closeManageLinkModal() {
		const modal = document.getElementById('ts-manage-link-modal');
		if (modal) {
			modal.style.display = 'none';
		}
	}
	
	function openManageLinkModal() {
		const modal = document.getElementById('ts-manage-link-modal');
		if (modal) {
			modal.style.display = 'block';
		}
	}
	</script>
</section>



<!-- ///////////////// -->
<!-- All Website Option Menu -->
<!-- ///////////////// -->
<div class="ts-allweb-options-menu" style="display: block;">
	<button class="ts-allweb-edit-btn">
		<svg class="ts-allweb-option-list-btn-icon" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
			<path d="M640-760v280l68 68q6 6 9 13.5t3 15.5v23q0 17-11.5 28.5T680-320H520v234q0 17-11.5 28.5T480-46q-17 0-28.5-11.5T440-86v-234H280q-17 0-28.5-11.5T240-360v-23q0-8 3-15.5t9-13.5l68-68v-280q-17 0-28.5-11.5T280-800q0-17 11.5-28.5T320-840h320q17 0 28.5 11.5T680-800q0 17-11.5 28.5T640-760ZM354-400h252l-46-46v-314H400v314l-46 46Zm126 0Z"/>
		</svg>
		Pin to My list
	</button>
	
	<button class="ts-allweb-share-btn">
		<svg class="ts-allweb-option-list-btn-icon" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
			<path d="M680-80q-50 0-85-35t-35-85q0-6 3-28L282-392q-16 15-37 23.5t-45 8.5q-50 0-85-35t-35-85q0-50 35-85t85-35q24 0 45 8.5t37 23.5l281-164q-2-7-2.5-13.5T560-760q0-50 35-85t85-35q50 0 85 35t35 85q0 50-35 85t-85 35q-24 0-45-8.5T598-672L317-508q2 7 2.5 13.5t.5 14.5q0 8-.5 14.5T317-452l281 164q16-15 37-23.5t45-8.5q50 0 85 35t35 85q0 50-35 85t-85 35Zm0-80q17 0 28.5-11.5T720-200q0-17-11.5-28.5T680-240q-17 0-28.5 11.5T640-200q0 17 11.5 28.5T680-160ZM200-440q17 0 28.5-11.5T240-480q0-17-11.5-28.5T200-520q-17 0-28.5 11.5T160-480q0 17 11.5 28.5T200-440Zm480-280q17 0 28.5-11.5T720-760q0-17-11.5-28.5T680-800q-17 0-28.5 11.5T640-760q0 17 11.5 28.5T680-720Zm0 520ZM200-480Zm480-280Z">
		</svg>
		Share
	</button>
	
	<button class="ts-allweb-copy-btn">
		<svg class="ts-allweb-option-list-btn-icon" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
			<path d="M360-240q-33 0-56.5-23.5T280-320v-480q0-33 23.5-56.5T360-880h360q33 0 56.5 23.5T800-800v480q0 33-23.5 56.5T720-240H360Zm0-80h360v-480H360v480ZM200-80q-33 0-56.5-23.5T120-160v-520q0-17 11.5-28.5T160-720q17 0 28.5 11.5T200-680v520h400q17 0 28.5 11.5T640-120q0 17-11.5 28.5T600-80H200Zm160-240v-480 480Z">
		</svg>
		Copy link
	</button>
</div>


<!-- Snackbar (hidden initially) -->
	<div id="web-snackbar" class="web-snackbar">Copied!</div>

<script>
// Snackbar function
function showWebSnackbar(message = "Copied!") {
  const snackbar = document.getElementById("web-snackbar");
  snackbar.textContent = message;
  snackbar.style.display = "block";
  snackbar.style.opacity = "1";

  setTimeout(() => {
    snackbar.style.opacity = "0";
    setTimeout(() => {
      snackbar.style.display = "none";
    }, 300);
  }, 2000);
}
</script>



<!-- ///////////////// -->
<!-- Footer Spacer -->
<!-- ///////////////// -->
<div class="footerSpacer">
</div>



<script>
  document.addEventListener("DOMContentLoaded", function () {
    const images = document.querySelectorAll("img");

    images.forEach(img => {
      img.onerror = function () {
        this.onerror = null;
        this.src = "images/nm/nm-placeholder.svg";
      };
    });
  });
</script>

<!-- ///////////////// -->
<!-- Bottom Menu -->
<!-- ///////////////// -->
<section>
<!-- SBM Trigger -->
<svg id="SBM-Icon" height="24px" viewBox="0 -960 960 960" width="24px" fill="#ffffff">
    <path d="M86-191v-126h788v126H86Zm0-226v-126h788v126H86Zm0-226v-126h788v126H86Z"/>
</svg>

<!-- SBM container (empty, the content is injected here) -->
<div id="SBM-container"></div>
</section>


<script>
window.onload = function() {		
    // Load SBM
    fetch('sbm.html')
        .then(response => response.text())
        .then(data => {
            const sidebarContainer = document.getElementById('SBM-container');
            sidebarContainer.innerHTML = data;

            // Make sure sidebar is hidden after load
            const overlaySBM = document.getElementById("SBM-section");
            if (overlaySBM) {
                overlaySBM.style.transform = "translateY(100%)";
            }

            // Reattach event listeners after the SBM is loaded
            const closeButton = document.getElementById("closeSBM");
            if (closeButton) {
                closeButton.addEventListener("click", closeSBM);
            }

            // Get reference to the icon that triggers the sidebar opening
            const SBMIcon = document.getElementById("SBM-Icon");

            // Function to open the sidebar
            function openSBM() {
                if (overlaySBM) {
                    overlaySBM.style.transform = "translateY(0)";
                }
            }

            // Function to close the sidebar
            function closeSBM() {
                if (overlaySBM) {
                    overlaySBM.style.transform = "translateY(100%)";
                }
            }

            // Event listener for opening the SBM when the icon is clicked
            if (SBMIcon) {
                SBMIcon.addEventListener("click", openSBM);
            }
        })
        .catch(error => {
            console.error("Error loading SBM:", error);
        });
};
</script>



<!-- ///////////////// -->
<!-- Theme Toggle -->
<!-- ///////////////// -->
<section>
<button id="theme-toggle">
    <!-- Default dark icon (SVG) -->
    <svg id="dark-icon" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
      <path d="M480-280q-83 0-141.5-58.5T280-480q0-83 58.5-141.5T480-680q83 0 141.5 58.5T680-480q0 83-58.5 141.5T480-280ZM200-440H40v-80h160v80Zm720 0H760v-80h160v80ZM440-760v-160h80v160h-80Zm0 720v-160h80v160h-80ZM256-650l-101-97 57-59 96 100-52 56Zm492 496-97-101 53-55 101 97-57 59Zm-98-550 97-101 59 57-100 96-56-52ZM154-212l101-97 55 53-97 101-59-57Z"/>
    </svg>

    <!-- Light Icon (hidden by default) -->
    <svg id="light-icon" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f" style="display: none;">
      <path d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Z"/>
    </svg>
</button>
</section>

<!-- ///////////////// -->
<!-- Set Theme - Based on Local Storage -->
<!-- ///////////////// -->
<script>
  // Wait for the DOM to be fully loaded before running the script
  document.addEventListener("DOMContentLoaded", function() {
    const themeLink = document.createElement("link");
    themeLink.rel = "stylesheet";
    themeLink.id = "theme-link";
    
    // Check if a theme preference is saved in localStorage
    const savedTheme = localStorage.getItem("theme");

    if (savedTheme === "dark") {
      themeLink.href = "dark-theme.css";  // If dark theme is saved, load dark-theme.css
    } else if (savedTheme === "light") {
      themeLink.href = "light-theme.css"; // If light theme is saved, load light-theme.css
    } else {
      themeLink.href = "dark-theme.css";  // Default to dark theme if no preference is saved
      localStorage.setItem('theme', 'dark');  // Save preference
    }

    // Append the theme <link> tag to the <head> of the document
    document.head.appendChild(themeLink);

    // Initialize icons based on saved theme preference
    const darkIcon = document.getElementById('dark-icon');
    const lightIcon = document.getElementById('light-icon');

    if (savedTheme === "dark") {
      lightIcon.style.display = 'none';
      darkIcon.style.display = 'block';
    } else {
      lightIcon.style.display = 'block';
      darkIcon.style.display = 'none';
    }

    // Toggle theme when button is clicked
    const themeToggleButton = document.getElementById('theme-toggle');

    themeToggleButton.addEventListener('click', () => {
      const currentTheme = themeLink.href.includes('dark-theme.css') ? 'dark' : 'light';
      if (currentTheme === 'dark') {
        themeLink.href = 'light-theme.css';  // Switch to light theme
        localStorage.setItem('theme', 'light');  // Save preference
        lightIcon.style.display = 'block';  // Show light icon
        darkIcon.style.display = 'none';   // Hide dark icon
      } else {
        themeLink.href = 'dark-theme.css';   // Switch to dark theme
        localStorage.setItem('theme', 'dark');  // Save preference
        lightIcon.style.display = 'none';   // Hide light icon
        darkIcon.style.display = 'block';   // Show dark icon
      }
    });
  });
</script>



<!-- ///////////////// -->
<!-- Fullscreen Toggle -->
<!-- ///////////////// -->
<section>
  <button id="fullscreen-toggle" class="fullscreen-button">
  <!-- Icon for entering fullscreen (initially displayed) -->
  <svg id="fullscreen-enter-icon" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
    <path d="M86-86v-260h126v134h134v126H86Zm529 0v-126h133v-134h126v260H615ZM86-615v-259h260v126H212v133H86Zm662 0v-133H615v-126h259v259H748Z"/>
  </svg>

  <!-- Icon for exiting fullscreen (hidden initially) -->
  <svg id="fullscreen-exit-icon" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f" style="display: none;">
    <path d="M220-86v-134H86v-126h260v260H220Zm395 0v-260h259v126H741v134H615ZM86-615v-126h134v-133h126v259H86Zm529 0v-259h126v133h133v126H615Z"/>
  </svg>
</button>
</section>
<script>
  // Fullscreen Toggle Logic
const fullscreenButton = document.getElementById('fullscreen-toggle');
fullscreenButton.addEventListener('click', () => {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen();
    document.getElementById('fullscreen-enter-icon').style.display = 'none';
    document.getElementById('fullscreen-exit-icon').style.display = 'block';
  } else {
    if (document.exitFullscreen) {
      document.exitFullscreen();
      document.getElementById('fullscreen-enter-icon').style.display = 'block';
      document.getElementById('fullscreen-exit-icon').style.display = 'none';
    }
  }
});

</script>


<!-- ///////////////// -->
<!-- Prevent Right Click Context Menu -->
<!-- ///////////////// -->
<script>
  document.addEventListener('contextmenu', function(event) {
    const target = event.target;

    // Allow default context menu on input, textarea, or contenteditable elements
    if (
      target.tagName === 'INPUT' ||
      target.tagName === 'TEXTAREA' ||
      target.isContentEditable
    ) {
      return; // allow context menu
    }

    event.preventDefault(); // otherwise, block it
  });
</script>

</body>
</html>
