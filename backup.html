	<!DOCTYPE html>
	<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=overlays-content">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<title>TKA - Backup</title>

		<!-- PWA Meta Tags -->
		<link rel="manifest" href="manifest.json">
		<link rel="icon" href="favicon.ico" sizes="any">
		<meta name="theme-color" content="#1A1A1A">

		<!-- Link to the stylesheet -->
		<link rel="stylesheet" href="styles.css">

	</head>
	<body>

	<section class="tak-header">
		<h1 class="tak-pagename"> Backup & Restore </h1>
	</section>

	<section class="bkup-container">
		<div class="bkup-container-description">
			<svg class="bkup-container-icons" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
				<path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h447q16 0 30.5 6t25.5 17l114 114q11 11 17 25.5t6 30.5v447q0 33-23.5 56.5T760-120H200Zm280-120q50 0 85-35t35-85q0-50-35-85t-85-35q-50 0-85 35t-35 85q0 50 35 85t85 35ZM280-560h280q17 0 28.5-11.5T600-600v-80q0-17-11.5-28.5T560-720H280q-17 0-28.5 11.5T240-680v80q0 17 11.5 28.5T280-560Z"/>
			</svg>
			Backup
		</div>
		<textarea id="backupOutput" class="bkup-Display" placeholder="Your backup data will appear here..."></textarea>
		<svg class="bkup-Display-drag-handle-icon" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
				<path d="m480-313 156-155q11-11 27.5-11.5T692-468q11 11 11 28t-11 28L508-228q-6 6-13 8.5t-15 2.5q-8 0-15-2.5t-13-8.5L268-412q-11-11-11.5-27.5T268-468q11-11 28-11t28 11l156 155Zm0-240 156-155q11-11 27.5-11.5T692-708q11 11 11 28t-11 28L508-468q-6 6-13 8.5t-15 2.5q-8 0-15-2.5t-13-8.5L268-652q-11-11-11.5-27.5T268-708q11-11 28-11t28 11l156 155Z"></path>
		</svg>
		<div class="bkup-container-actionBtns">
			<button id="bkup-actionBtn-generateBtn" class="bkup-container-actionBtns-primary" onclick="generateBackup()">Generate</button>
			<button id="bkup-actionBtn-copyBtn" class="bkup-container-actionBtns-secondary" onclick="copyBackup()">Copy</button>
		</div>
	</section>

	<section class="bkup-container">
		<div class="bkup-container-description">
			<svg class="bkup-container-icons" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
				<path d="M480-120q-138 0-240.5-91.5T122-440h82q14 104 92.5 172T480-200q117 0 198.5-81.5T760-480q0-117-81.5-198.5T480-760q-69 0-129 32t-101 88h110v80H120v-240h80v94q51-64 124.5-99T480-840q75 0 140.5 28.5t114 77q48.5 48.5 77 114T840-480q0 75-28.5 140.5t-77 114q-48.5 48.5-114 77T480-120Zm112-192L440-464v-216h80v184l128 128-56 56Z"/>
			</svg>
			Restore
		</div>
		<textarea id="restoreInput" class="bkup-Display" placeholder="Paste your data here..."></textarea>
		<svg class="bkup-Display-drag-handle-icon" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
				<path d="m480-313 156-155q11-11 27.5-11.5T692-468q11 11 11 28t-11 28L508-228q-6 6-13 8.5t-15 2.5q-8 0-15-2.5t-13-8.5L268-412q-11-11-11.5-27.5T268-468q11-11 28-11t28 11l156 155Zm0-240 156-155q11-11 27.5-11.5T692-708q11 11 11 28t-11 28L508-468q-6 6-13 8.5t-15 2.5q-8 0-15-2.5t-13-8.5L268-652q-11-11-11.5-27.5T268-708q11-11 28-11t28 11l156 155Z"></path>
		</svg>
		<div class="bkup-container-actionBtns">
			<button id="bkup-actionBtn-validateBtn" class="bkup-container-actionBtns-primary" onclick="validateRestore()">Validate</button>
		</div>
	</section>



	<section class="bkup-container">
		<div class="bkup-container-description">
			<svg class="bkup-container-icons" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
				<path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h167q11-35 43-57.5t70-22.5q40 0 71.5 22.5T594-840h166q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560h-80v80q0 17-11.5 28.5T640-640H320q-17 0-28.5-11.5T280-680v-80h-80v560Zm280-560q17 0 28.5-11.5T520-800q0-17-11.5-28.5T480-840q-17 0-28.5 11.5T440-800q0 17 11.5 28.5T480-760Z"/>
			</svg>
			Sample
		</div>
		<textarea id="" class="bkup-Display" placeholder="Refresh this page to get the sample data here...">
{"UserSites":[{"name":"Amazon IN","url":"https://www.amazon.in/","img":"https://www.amazon.in/favicon.ico","position":0,"id":1},{"name":"Flipkart","url":"https://www.flipkart.com/","img":"https://rukminim1.flixcart.com/www/192/192/promos/11/07/2024/cf1a3e0a-224b-4dd1-bb96-84abf3d298e2.png?q=100","position":1,"id":2},{"name":"Airtel IN","url":"https://www.airtel.in/","img":"https://assets.airtel.in/static-assets/new-home/img/favicon-32x32.png","position":2,"id":3},{"name":"DrikPanchang","url":"https://www.drikpanchang.com/","img":"https://www.drikpanchang.com/images/logo/1x/xlogo_panditji.png.pagespeed.ic.mkg5bEbgC7.webp","position":3,"id":4}],"UserNotes":[{"data":"Ambience","id":1},{"data":"Area 360","id":2},{"data":"Panorama","id":3},{"data":"Random","id":4},{"data":"Compass & Level","id":5},{"data":"Games","id":6},	{"data":"Music","id":7}]}
		</textarea>
		<svg class="bkup-Display-drag-handle-icon" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
				<path d="m480-313 156-155q11-11 27.5-11.5T692-468q11 11 11 28t-11 28L508-228q-6 6-13 8.5t-15 2.5q-8 0-15-2.5t-13-8.5L268-412q-11-11-11.5-27.5T268-468q11-11 28-11t28 11l156 155Zm0-240 156-155q11-11 27.5-11.5T692-708q11 11 11 28t-11 28L508-468q-6 6-13 8.5t-15 2.5q-8 0-15-2.5t-13-8.5L268-652q-11-11-11.5-27.5T268-708q11-11 28-11t28 11l156 155Z"></path>
		</svg>
	</section>



  <script>
    const DB_NAME = "TAKAppDB";
    const DB_VERSION = 3;
    const STORE_SITES = "CustomSites";
    const STORE_NOTES = "UserNotes";
    let db;


    function initDB() {
      const request = indexedDB.open(DB_NAME, DB_VERSION);

      request.onupgradeneeded = function(e) {
        db = e.target.result;
        if (!db.objectStoreNames.contains(STORE_SITES)) {
          db.createObjectStore(STORE_SITES, { keyPath: "id", autoIncrement: true });
        }
        if (!db.objectStoreNames.contains(STORE_NOTES)) {
          db.createObjectStore(STORE_NOTES, { keyPath: "id", autoIncrement: true });
        }
      };


      request.onerror = function(e) {
        showTakSnackbar("DB error: " + e.target.errorCode);
      };
    }


    function generateBackup() {
      const output = { UserSites: [], UserNotes: [] };
      const tx = db.transaction([STORE_SITES, STORE_NOTES], "readonly");

      const sites = tx.objectStore(STORE_SITES).getAll();
      const notes = tx.objectStore(STORE_NOTES).getAll();

      sites.onsuccess = function () {
        output.UserSites = sites.result;

        notes.onsuccess = function () {
          output.UserNotes = notes.result;
          document.getElementById("backupOutput").value = JSON.stringify(output, null, 2);
          showTakSnackbar("Backup generated");
        };
      };
    }

    function copyBackup() {
      const text = document.getElementById("backupOutput").value;
      navigator.clipboard.writeText(text).then(() => {
        showTakSnackbar("Copied to clipboard");
      });
    }

    function validateRestore() {
      const input = document.getElementById("restoreInput").value;
      let parsed;

      try {
        parsed = JSON.parse(input);
        if (!parsed.UserSites || !parsed.UserNotes) {
          throw new Error("Invalid format");
        }
      } catch (e) {
        showTakSnackbar("Invalid JSON");
        return;
      }

      const tx = db.transaction([STORE_SITES, STORE_NOTES], "readwrite");
      const sites = tx.objectStore(STORE_SITES);
      const notes = tx.objectStore(STORE_NOTES);

      sites.clear();
      notes.clear();

      parsed.UserSites.forEach(s => sites.put(s));
      parsed.UserNotes.forEach(n => notes.put(n));

      tx.oncomplete = () => showTakSnackbar("Data restored successfully");
    }

    window.onload = initDB;
  </script>




<!-- Snackbar (hidden initially) -->
<div id="tak-snackbar" class="tak-snackbar">Welcome!</div>

<!-- Confirm Delete Dialog (hidden initially) -->
<div id="bkup-confirm-dialog" class="bkup-dialog" style="display: none;">
	<div class="bkup-dialog-box">
		<p>Creating backup of your current data is recommended. Click "Continue" to permanently replace your current data.</p>
		<div class="bkup-dialog-actions">
			<button id="bkup-dialog-skip">Skip</button>
			<button id="bkup-dialog-continue">Continue</button>
		</div>
	</div>
</div>

<script>
// Snackbar function
function showTakSnackbar(message = "Welcome!") {
  const snackbar = document.getElementById("tak-snackbar");
  snackbar.textContent = message;
  snackbar.style.display = "block";
  snackbar.style.opacity = "1";

  setTimeout(() => {
	snackbar.style.opacity = "0";
	setTimeout(() => {
	  snackbar.style.display = "none";
	}, 300);
  }, 2000);
}
</script>



<!-- ///////////////// -->
<!-- Footer Spacer -->
<!-- ///////////////// -->
<div class="footerSpacer">
</div>




<!-- ///////////////// -->
<!-- Prevent Right Click Context Menu -->
<!-- ///////////////// -->
<script>
  document.addEventListener('contextmenu', function(event) {
    const target = event.target;

    // Allow default context menu on input, textarea, or contenteditable elements
    if (
      target.tagName === 'INPUT' ||
      target.tagName === 'TEXTAREA' ||
      target.isContentEditable
    ) {
      return; // allow context menu
    }

    event.preventDefault(); // otherwise, block it
  });
</script>


</body>
</html>
