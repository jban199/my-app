<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Sniper</title>
  <style>
    /* Reset + fullscreen */
    html, body {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }

    /* Shared screens */
    .screen {
      width: 100%;
      height: 100%;
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      text-align: center;
    }

    /* Instruction screen */
    #instruction-screen {
      background: linear-gradient(180deg, #ff7e5f, #feb47b);
      color: #fff;
    }
    #instruction-screen h1 {
      font-size: 8vw;
    }
    #instruction-screen button {
      font-size: 5vw;
      padding: 2vh 4vh;
      margin: 2vh;
      border: none;
      border-radius: 2vh;
      background: #fff;
      color: #333;
      font-weight: bold;
    }
	
	.instruction-gamecard {
			display:flex;
			align-items:center;
			justify-content:center;
			gap:1vw;
			margin-bottom:2vh;
		  }
		  
		  .instruction-gamecard-gameicon {
			width:10vw;
			max-width:60px;
		  }
		  
		  .instruction-gamecard-gamename {
			font-size:7vw;
			margin:0;
		  }
		  
		  .instruction-game-story {
			font-size:4vw;
			max-width:90%;
			margin:2vh auto;
		  }
		  
		  .instruction-score-table {
			display:flex;
			flex-direction:column;
			align-items:center;
			gap:1vh;
			margin:3vh 0;
		  }
		  
		  .instruction-score-item-row {
			display:flex;
			align-items:center;
			justify-content:space-between;
			width:80%;
			background:rgba(255,255,255,0.2);
			padding:1vh 2vw;
			border-radius:1vh;
		  }
		  .instruction-score-item-img {
			width:8vw;
			max-width:50px;
		  }
		  
		  .instruction-score-item-score {
			font-size:4vw;
		  }
		  
		  .instruction-score-item-benefit {
		  	font-size:4vw;
		  }
		  
		  .instruction-gamecard {
			display:flex;
			align-items:center;
			justify-content:center;
			gap:1vw;
			margin-bottom:2vh;
		  }
		  
		  .instruction-gamecard-gameicon {
			width:15vw;
			max-width:60px;
		  }
		  
		  .instruction-gamecard-gamename {
			font-size:7vw;
			margin:0;
		  }
		  
		  .instruction-game-story {
			font-size:4vw;
			max-width:90%;
			margin:2vh auto;
		  }
		  
		  .instruction-score-table {
			display:flex;
			flex-direction:column;
			align-items:center;
			gap:1vh;
			margin:3vh 0;
		  }
		  
		  .instruction-score-item-row {
			display:flex;
			align-items:center;
			justify-content:space-between;
			width:80%;
			background:rgba(255,255,255,0.2);
			padding:1vh 2vw;
			border-radius:1vh;
		  }
		  .instruction-score-item-img {
			width:8vw;
			max-width:50px;
		  }
		  
		  .instruction-score-item-name {
			font-size:4vw;
		  }
		  
		  .instruction-score-item-benefit {
		  	font-size:4vw;
			max-width: 70px;
		  }

    /* Game screen */
    #game-screen {
      background: linear-gradient(180deg, #66a6ff, #004e92);
      position: relative;
      overflow: hidden;
    }
    #hud {
      position: absolute;
      top: 1vh;
      left: 1vw;
	  width: 90vw;
      color: #fff;
      font-size: 5vw;
      background: rgba(0,0,0,0.4);
      padding: 1vh 2vw;
      border-radius: 1vh;
	  display: flex;
	  align-items: center;
	  justify-content: center;
    }
	
	#hud svg {
		fill: #ffffff80;
		margin-left: 25px;
		margin-right: 5px;
	}

    .launcher {
      position: absolute;
      bottom: 2vh;
      left: 50%;
      transform: translateX(-70%);
      width: 24vw;
    }
    .bullet {
      position: absolute;
	  right: 0%;
      transform: translateX(30%);
      width: auto;
      height: 4vh;
    }
    .object {
      position: absolute;
      width: 15vw;
    }

    /* Game over screen */
    #game-over-screen {
      background: linear-gradient(180deg, #232526, #414345);
      color: #fff;
    }
    #game-over-screen h2 {
      font-size: 7vw;
      margin-bottom: 3vh;
    }
    #game-over-screen p {
      font-size: 4.5vw;
      margin: 1vh 0;
    }
    #game-over-screen button {
      font-size: 5vw;
      padding: 2vh 4vh;
      margin: 2vh;
      border: none;
      border-radius: 2vh;
      background: #fff;
      color: #333;
      font-weight: bold;
    }
	
	.popup-text {
		position: absolute;
		font-size: 4vw;
		font-weight: bold;
		color: #fff;
		text-shadow: 1px 1px 4px #000;
		animation: floatUp 1s ease-out forwards;
		pointer-events: none;
	}
	@keyframes floatUp {
		from { opacity: 1; transform: translateY(0); }
		to { opacity: 0; transform: translateY(-40px); }
	}


    /* Snackbar */
    #snackbar {
      visibility: hidden;
      min-width: 50vw;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 1vh;
      padding: 2vh;
      position: fixed;
      left: 50%;
      bottom: 10vh;
      transform: translateX(-50%);
      font-size: 4vw;
      z-index: 1000;
    }
    #snackbar.show {
      visibility: visible;
      animation: fadein 0.5s, fadeout 0.5s 2.5s;
    }
    @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 10vh; opacity: 1;} }
    @keyframes fadeout { from {bottom: 10vh; opacity: 1;} to {bottom: 0; opacity: 0;} }

    /* Animations for hit & muzzle flash */
    .hit-burst {
      width: 12vw;
      height: 12vw;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,0,0.8) 0%, rgba(255,0,0,0) 70%);
      position: absolute;
      animation: burst 0.3s ease-out forwards;
    }
    @keyframes burst {
      from { transform: scale(0.3); opacity: 1; }
      to { transform: scale(1.5); opacity: 0; }
    }

    .muzzle-flash {
      width: 6vw;
      height: 6vw;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,0,0.9) 0%, rgba(255,0,0,0) 70%);
      position: absolute;
      animation: flash 0.2s ease-out forwards;
    }
    @keyframes flash {
      from { transform: scale(0.2); opacity: 1; }
      to { transform: scale(1); opacity: 0; }
    }
  </style>
</head>
<body>

	<!-- Instruction Screen -->
	<div id="instruction-screen" class="screen" style="display: flex;">
	  <div style="text-align:center; color:#fff; padding:2vh;">
		<!-- Game Icon + Name -->
		<div class="instruction-gamecard">
		  <img class="instruction-gamecard-gameicon" src="specialforce.png" alt="Game Icon">
		  <h1 class="instruction-gamecard-gamename">Sniper Down</h1>
		</div>

		<!-- Game Story -->
		<p class="instruction-game-story">
		  You are a pro-shooter with limited ammo and time as resources. Shoot down high value targets to get more score. 
		  Focus on extra ammo or buy time to survive longer.
		</p>

		<!-- Object Info Table -->
		<div class="instruction-score-table">
		  
		  <div class="instruction-score-item-row">
			<img class="instruction-score-item-img" src="major.png"> 
			<span class="instruction-score-item-name">Major</span> 
			<span class="instruction-score-item-benefit">Score 40</span>
		  </div>
		  
		  <div class="instruction-score-item-row">
			<img class="instruction-score-item-img" src="sniper.png"> 
			<span class="instruction-score-item-name">Sniper</span> 
			<span class="instruction-score-item-benefit">Score 25</span>
		  </div>
		  
		  <div class="instruction-score-item-row">
			<img class="instruction-score-item-img" src="pilot.png"> 
			<span class="instruction-score-item-name">Pilot</span> 
			<span class="instruction-score-item-benefit">Score 20</span>
		  </div>
		  
		  <div class="instruction-score-item-row">
			<img class="instruction-score-item-img" src="paratrooper.png"> 
			<span class="instruction-score-item-name">Paratrooper</span> 
			<span class="instruction-score-item-benefit">Score 10</span>
		  </div>
		  
		  <div class="instruction-score-item-row">
			<img class="instruction-score-item-img" src="specialforce.png"> 
			<span class="instruction-score-item-name">Commando</span> 
			<span class="instruction-score-item-benefit">Score 10</span>
		  </div>
		  
		  <div class="instruction-score-item-row">
			<img class="instruction-score-item-img" src="infantry.png"> 
			<span class="instruction-score-item-name">Infantry</span> 
			<span class="instruction-score-item-benefit">Score 5</span>
		  </div>
		  
		  <div class="instruction-score-item-row">
			<img class="instruction-score-item-img" src="drone.png"> 
			<span class="instruction-score-item-name">Drone</span> 
			<span class="instruction-score-item-benefit">Score 10, Time +10</span>
		  </div>
		  
		  <div class="instruction-score-item-row">
			<img class="instruction-score-item-img" src="supply.png"> 
			<span class="instruction-score-item-name">Supply</span> 
			<span class="instruction-score-item-benefit">Ammo +10</span>
		  </div>
		  
		</div>

		<!-- Play Button -->
		<button onclick="startGame()">Play Now</button>
	  </div>
	</div>


  <!-- Game Screen -->
  <div id="game-screen" class="screen">
    <div id="hud">
		<svg height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
			<path d="m305-704 112-145q12-16 28.5-23.5T480-880q18 0 34.5 7.5T543-849l112 145 170 57q26 8 41 29.5t15 47.5q0 12-3.5 24T866-523L756-367l4 164q1 35-23 59t-56 24q-2 0-22-3l-179-50-179 50q-5 2-11 2.5t-11 .5q-32 0-56-24t-23-59l4-165L95-523q-8-11-11.5-23T80-570q0-25 14.5-46.5T135-647l170-57Z"/>
		</svg> 
		<span id="score">0</span>
		
		<svg height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
			<path d="M240-800q12-12 28.5-12t28.5 12l63 64q12 12 12 28t-12 28q-12 12-28.5 12T303-680l-64-63q-12-12-11.5-28.5T240-800Zm280-116q17 0 28.5 11.5T560-876v90q0 17-11.5 28.5T520-746q-17 0-28.5-11.5T480-786v-90q0-17 11.5-28.5T520-916Zm160 556q12-12 28.5-12t28.5 12l63 64q12 12 12 28t-12 28q-12 12-28.5 12T743-240l-64-63q-12-12-11.5-28.5T680-360Zm120-440q12 12 12 28.5T800-743l-64 64q-12 12-28 11.5T680-680q-12-12-12-28.5t12-28.5l63-63q12-12 28.5-12t28.5 12Zm116 280q0 17-11.5 28.5T876-480h-90q-17 0-28.5-11.5T746-520q0-17 11.5-28.5T786-560h90q17 0 28.5 11.5T916-520ZM205-92 92-205q-12-12-12-28t12-28l363-364q35-35 85-35t85 35q35 35 35 85t-35 85L261-92q-12 12-28 12t-28-12Zm279-335 84-85q12-12 12-28t-12-28q-12-12-28-12t-28 12l-85 85 57 56Z"/>
		</svg>
		<span id="ammo">20</span>
		
		<svg height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
			<path d="M360-840v-80h240v80H360Zm80 440h80v-240h-80v240Zm40 320q-74 0-139.5-28.5T226-186q-49-49-77.5-114.5T120-440q0-74 28.5-139.5T226-694q49-49 114.5-77.5T480-800q62 0 119 20t107 58l56-56 56 56-56 56q38 50 58 107t20 119q0 74-28.5 139.5T734-186q-49 49-114.5 77.5T480-80Zm0-80q116 0 198-82t82-198q0-116-82-198t-198-82q-116 0-198 82t-82 198q0 116 82 198t198 82Zm0-280Z"/>
		</svg>
		<span id="time">60</span>
	</div>
    <img src="player_sniper.png" class="launcher" id="launcher">
  </div>

  <!-- Game Over Screen -->
  <div id="game-over-screen" class="screen">
    <h2>Game Over</h2>
    <p>Final Score: <span id="final-score">0</span></p>
    <p>Missed Fires: <span id="missed-fires">0</span></p>
    <button onclick="startGame()">Play Again</button>
    <button onclick="goBack()">Exit game</button>
  </div>

  <!-- Snackbar -->
  <div id="snackbar"></div>

  <!-- Sounds -->
  <audio id="snd-fire" src="gunshot.wav" preload="auto"></audio>
  <audio id="snd-hit" src="bulletstrike.wav" preload="auto"></audio>
  <audio id="snd-bg" src="backgroundscore.wav" preload="auto" loop></audio>

  <script>
    // === GAME VARIABLES ===
    const objectsData = [
	  { src: "infantry.png", score: 5, freq: 0.3, speed: 2, gameOver: false },
	  { src: "specialforce.png", score: 10, freq: 0.2, speed: 2, gameOver: false },
	  { src: "paratrooper.png", score: 10, freq: 0.1, speed: 4, gameOver: false },
	  { src: "pilot.png", score: 20, freq: 0.1, speed: 3, gameOver: false },
	  { src: "sniper.png", score: 25, freq: 0.1, speed: 4, gameOver: false },
      { src: "major.png", score: 40, freq: 0.05, speed: 4, gameOver: false },
	  { src: "drone.png", score: 10, freq: 0.1, speed: 3, gameOver: false, addTime: 10 },
      { src: "supply.png", score: 0, freq: 0.1, speed: 3, gameOver: false, addAmmo: 10 }
    ];
    let score = 0, ammo = 20, time = 60, missedFires = 0;
    let gameInterval, spawnInterval, countdownInterval;

    // === UTILS ===
    function showSnackbar(msg) {
      const bar = document.getElementById("snackbar");
      bar.textContent = msg;
      bar.className = "show";
      setTimeout(() => bar.className = bar.className.replace("show", ""), 3000);
    }
	
	function showPopup(text, obj, color = "#fff", offsetY = 0) {
		const rect = obj.getBoundingClientRect();
		const gameRect = document.getElementById("game-screen").getBoundingClientRect();

		const popup = document.createElement("div");
		popup.className = "popup-text";
		popup.textContent = text;
		popup.style.color = color;

		popup.style.left = (rect.left - gameRect.left + rect.width / 2) + "px";
		// shift each popup by offsetY
		popup.style.top = (rect.top - gameRect.top + offsetY) + "px";

		document.getElementById("game-screen").appendChild(popup);

		popup.animate([
		{ transform: "translate(-50%, 0)", opacity: 1 },
		{ transform: "translate(-50%, -40px)", opacity: 0 }
		], { duration: 1000, easing: "ease-out" });

		setTimeout(() => popup.remove(), 1000);
	}



	
    function playSound(id) {
      const el = document.getElementById(id);
      el.currentTime = 0;
      el.play();
    }
    function startBackgroundMusic() {
      const bg = document.getElementById("snd-bg");
      bg.volume = 0.4;
      bg.play();
    }
    function stopBackgroundMusic() {
      const bg = document.getElementById("snd-bg");
      bg.pause();
      bg.currentTime = 0;
    }

    // === GAME FLOW ===
    function startGame() {
      document.getElementById("instruction-screen").style.display = "none";
      document.getElementById("game-over-screen").style.display = "none";
      document.getElementById("game-screen").style.display = "flex";

      score = 0; ammo = 20; time = 60; missedFires = 0;
      document.getElementById("score").textContent = score;
      document.getElementById("ammo").textContent = ammo;
      document.getElementById("time").textContent = time;

      startBackgroundMusic();

      gameInterval = setInterval(moveObjects, 50);
      spawnInterval = setInterval(spawnObject, 1200);
      countdownInterval = setInterval(() => {
        time--;
        document.getElementById("time").textContent = time;
        if (time <= 0) gameOver();
      }, 1000);
    }

    function gameOver() {
      clearInterval(gameInterval);
      clearInterval(spawnInterval);
      clearInterval(countdownInterval);
      stopBackgroundMusic();

      document.getElementById("game-screen").style.display = "none";
      document.getElementById("game-over-screen").style.display = "flex";
      document.getElementById("final-score").textContent = score;
      document.getElementById("missed-fires").textContent = missedFires;

      // cleanup
      document.querySelectorAll(".object, .bullet, .hit-burst, .muzzle-flash").forEach(el => el.remove());
    }

    function goBack() {
      document.getElementById("game-over-screen").style.display = "none";
      document.getElementById("instruction-screen").style.display = "flex";
	  window.history.back();
    }

    // === GAME ACTIONS ===
    document.getElementById("game-screen").addEventListener("click", fireBullet);

    function fireBullet() {
      if (ammo <= 0) {
        showSnackbar("Out of ammo!");
        return;
      }
      ammo--;
      document.getElementById("ammo").textContent = ammo;

      const launcher = document.getElementById("launcher");
      const rect = launcher.getBoundingClientRect();
      const gameRect = document.getElementById("game-screen").getBoundingClientRect();

      // create bullet image (restored)
      const bullet = document.createElement("img");
      bullet.src = "bullet.svg";
      bullet.className = "bullet";
      bullet.style.left = (rect.left + rect.width / 2 - gameRect.left - 1) + "px";
      bullet.style.top = (rect.top - gameRect.top - 20) + "px";
      document.getElementById("game-screen").appendChild(bullet);

      // Muzzle flash
      const flash = document.createElement("div");
      flash.className = "muzzle-flash";
      flash.style.left = (rect.left + rect.width/2 - gameRect.left - -8) + "px";
      flash.style.top = (rect.top - gameRect.top - 10) + "px";
      document.getElementById("game-screen").appendChild(flash);
      setTimeout(() => flash.remove(), 200);

      playSound("snd-fire");

      let moveBullet = setInterval(() => {
        let top = parseInt(bullet.style.top);
        if (top <= 0) {
          bullet.remove();
          clearInterval(moveBullet);
          missedFires++;
          return;
        }
        bullet.style.top = (top - 20) + "px";
        checkCollision(bullet, moveBullet);
      }, 30);

      if (ammo <= 0) {
		  // Give a 2-second grace period before checking again
		  setTimeout(() => {
			if (ammo <= 0) gameOver();
		  }, 2000);
		}
    }

    function spawnObject() {
      const data = chooseObject();
      if (!data) return;
      const obj = document.createElement("img");
      obj.src = data.src;
      obj.className = "object";
      obj.dataset.score = data.score;
      obj.dataset.gameOver = data.gameOver || false;
      obj.dataset.addTime = data.addTime || 0;
      obj.dataset.addAmmo = data.addAmmo || 0;
      obj.dataset.speed = data.speed;

      const fromLeft = Math.random() > 0.5;
      const game = document.getElementById("game-screen");
      const gameWidth = game.clientWidth;
      const gameHeight = game.clientHeight;

      obj.style.top = (8 * window.innerHeight / 100 + Math.random() * gameHeight * 0.25) + "px";
      obj.style.left = fromLeft ? "0px" : gameWidth + "px";
      obj.dataset.direction = fromLeft ? "right" : "left";

      if (!fromLeft) obj.style.transform = "scaleX(-1)";

      game.appendChild(obj);
    }

    function moveObjects() {
      document.querySelectorAll(".object").forEach(obj => {
        let left = parseInt(obj.style.left);
        const dir = obj.dataset.direction;
        const speed = parseFloat(obj.dataset.speed) * 2;
        if (dir === "right") {
          obj.style.left = (left + speed) + "px";
          if (left > window.innerWidth) obj.remove();
        } else {
          obj.style.left = (left - speed) + "px";
          if (left < -50) obj.remove();
        }
      });
    }

    function checkCollision(bullet, moveBullet) {
      const bRect = bullet.getBoundingClientRect();
      document.querySelectorAll(".object").forEach(obj => {
        const oRect = obj.getBoundingClientRect();
        if (!(bRect.right < oRect.left || bRect.left > oRect.right || bRect.bottom < oRect.top || bRect.top > oRect.bottom)) {
          clearInterval(moveBullet);
          bullet.remove();
          handleHit(obj);
        }
      });
    }

	function handleHit(obj) {
		const scoreVal = parseInt(obj.dataset.score);
		const addTime = parseInt(obj.dataset.addTime);
		const addAmmo = parseInt(obj.dataset.addAmmo);

		if (obj.dataset.gameOver === "true") {
		obj.remove();
		playSound("snd-hit");
		showBurst(obj);
		gameOver();
		return;
		}

		let offsetStep = 0;

		if (!isNaN(scoreVal) && scoreVal > 0) {
		score += scoreVal;
		document.getElementById("score").textContent = score;
		showPopup("+" + scoreVal, obj, "#ffeb3b", offsetStep);
		offsetStep += 20;
		}

		if (!isNaN(addTime) && addTime > 0) {
		time += addTime;
		document.getElementById("time").textContent = time;
		showPopup("+" + addTime + "s", obj, "#4caf50", offsetStep);
		offsetStep += 20;
		}

		if (!isNaN(addAmmo) && addAmmo > 0) {
		ammo += addAmmo;
		document.getElementById("ammo").textContent = ammo;
		showPopup("+" + addAmmo + " ammo", obj, "#03a9f4", offsetStep);
		offsetStep += 20;
		}

		playSound("snd-hit");
		showBurst(obj);
		obj.remove();
	}



    function showBurst(obj) {
      const rect = obj.getBoundingClientRect();
      const gameRect = document.getElementById("game-screen").getBoundingClientRect();
      const burst = document.createElement("div");
      burst.className = "hit-burst";
      burst.style.left = (rect.left - gameRect.left) + "px";
      burst.style.top = (rect.top - gameRect.top) + "px";
      document.getElementById("game-screen").appendChild(burst);
      setTimeout(() => burst.remove(), 300);
    }

    function chooseObject() {
      const r = Math.random();
      let cumulative = 0;
      for (let obj of objectsData) {
        cumulative += obj.freq;
        if (r < cumulative) return obj;
      }
      return null;
    }
  </script>
</body>
</html>
